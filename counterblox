--[[
Script completo com GUI moderna
Recursos: Noclip, Speed Slider, ESP, Highlight por time, Click TP, Fly, Aimbot, Silent Aim, No Recoil inteligente, SkinChanger
GUI moderna com bordas arredondadas, barra superior, fechar/minimizar/tela cheia e toggle com Insert
--]]

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")

-- =====================
-- Criar GUI moderna
-- =====================
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ESP_GUI_Modern"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = game.CoreGui

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 400, 0, 600)
MainFrame.Position = UDim2.new(0, 100, 0, 100)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MainFrame.BorderSizePixel = 0
MainFrame.Visible = false
MainFrame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 12)
UICorner.Parent = MainFrame

-- Barra superior
local TopBar = Instance.new("Frame")
TopBar.Size = UDim2.new(1, 0, 0, 30)
TopBar.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
TopBar.BorderSizePixel = 0
TopBar.Parent = MainFrame

local TopBarCorner = Instance.new("UICorner")
TopBarCorner.CornerRadius = UDim.new(0, 12)
TopBarCorner.Parent = TopBar

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -100, 1, 0)
Title.Position = UDim2.new(0, 10, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "ESP GUI Modern"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 18
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = TopBar

local function createWindowButton(text, posX)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0, 25, 0, 25)
    btn.Position = UDim2.new(1, -posX, 0, 2)
    btn.Text = text
    btn.BackgroundColor3 = Color3.fromRGB(50,50,50)
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.Font = Enum.Font.SourceSansBold
    btn.TextSize = 18
    btn.AutoButtonColor = true
    btn.Parent = TopBar

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0,6)
    corner.Parent = btn

    return btn
end

local CloseButton = createWindowButton("X", 5)
local MinimizeButton = createWindowButton("_", 35)
local FullscreenButton = createWindowButton("☐", 65)

CloseButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = false
end)

MinimizeButton.MouseButton1Click:Connect(function()
    MainFrame.Size = UDim2.new(0, 400, 0, 30)
end)

FullscreenButton.MouseButton1Click:Connect(function()
    MainFrame.Size = UDim2.new(1, 0, 1, 0)
    MainFrame.Position = UDim2.new(0, 0, 0, 0)
end)

-- Arrastar GUI
local dragging = false
local dragInput, mousePos, framePos

TopBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        mousePos = input.Position
        framePos = MainFrame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

TopBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

UIS.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - mousePos
        MainFrame.Position = UDim2.new(framePos.X.Scale, framePos.X.Offset + delta.X, framePos.Y.Scale, framePos.Y.Offset + delta.Y)
    end
end)

-- Toggle GUI com Insert
UIS.InputBegan:Connect(function(input, gpe)
    if gpe then return end
    if input.KeyCode == Enum.KeyCode.Insert then
        MainFrame.Visible = not MainFrame.Visible
        if MainFrame.Visible and MainFrame.Size.Y.Offset == 30 then
            MainFrame.Size = UDim2.new(0, 400, 0, 600)
        end
    end
end)

-- Função utilitária para criar botões modernos
local function createButton(text, order)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, -20, 0, 35)
    button.Position = UDim2.new(0, 10, 0, 40 + (45 * order))
    button.Text = text
    button.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.Font = Enum.Font.SourceSans
    button.TextSize = 16
    button.Parent = MainFrame

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0,8)
    corner.Parent = button

    return button
end

-- =====================
-- Variáveis de controle
-- =====================
local noclip = false
local currentSpeed = 16
local ESPEnabled = false
local highlightsEnabled = false
local clickTP = false
local flying = false
local flySpeed = 50
local flyConn, bodyGyro, bodyVel
local aimbotEnabled = false
local silentAimEnabled = false
local noRecoilSmart = false
local drawings = {}

-- =====================
-- Funções utilitárias
-- =====================
local function getTeamColor(player)
    local team = player.Team
    return team and team.TeamColor.Color or Color3.new(1,1,1)
end

-- =====================
-- BOTÕES E FUNCIONALIDADES
-- =====================

-- Noclip
createButton("Noclip", 0).MouseButton1Click:Connect(function()
    noclip = not noclip
end)

RunService.Stepped:Connect(function()
    if noclip and LocalPlayer.Character then
        for _, part in ipairs(LocalPlayer.Character:GetDescendants()) do
            if part:IsA("BasePart") and part.CanCollide then
                part.CanCollide = false
            end
        end
    end
end)

-- Speed++
createButton("Speed++", 1).MouseButton1Click:Connect(function()
    currentSpeed = math.min(100, currentSpeed + 5)
    if LocalPlayer.Character then
        local hum = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if hum then hum.WalkSpeed = currentSpeed end
    end
end)

-- Speed--
createButton("Speed--", 2).MouseButton1Click:Connect(function()
    currentSpeed = math.max(16, currentSpeed - 5)
    if LocalPlayer.Character then
        local hum = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if hum then hum.WalkSpeed = currentSpeed end
    end
end)

-- ESP Toggle
createButton("ESP Toggle", 3).MouseButton1Click:Connect(function()
    ESPEnabled = not ESPEnabled
end)

RunService.RenderStepped:Connect(function()
    for _, draw in pairs(drawings) do
        draw.Text:Remove()
        draw.Line:Remove()
    end
    drawings = {}

    if not ESPEnabled then return end

    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local rootPart = player.Character.HumanoidRootPart
            local screenPos, onScreen = Camera:WorldToViewportPoint(rootPart.Position)
            if onScreen then
                local distance = math.floor((Camera.CFrame.Position - rootPart.Position).Magnitude)
                local nameText = player.Name.." ["..distance.."m]"

                local text = Drawing.new("Text")
                text.Text = nameText
                text.Size = 13
                text.Center = true
                text.Outline = true
                text.Color = getTeamColor(player)
                text.Position = Vector2.new(screenPos.X, screenPos.Y - 20)
                text.Visible = true

                local line = Drawing.new("Line")
                line.From = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y)
                line.To = Vector2.new(screenPos.X, screenPos.Y)
                line.Color = getTeamColor(player)
                line.Thickness = 1
                line.Visible = true

                table.insert(drawings, {Text=text, Line=line})
            end
        end
    end
end)

-- Highlight por time
createButton("Highlight Toggle", 4).MouseButton1Click:Connect(function()
    highlightsEnabled = not highlightsEnabled
    for _, player in ipairs(Players:GetPlayers()) do
        if player.Character then
            local hl = player.Character:FindFirstChild("Highlight")
            if hl then hl:Destroy() end
            if highlightsEnabled then
                local highlight = Instance.new("Highlight")
                highlight.FillColor = getTeamColor(player)
                highlight.OutlineColor = Color3.new(1,1,1)
                highlight.FillTransparency = 0.5
                highlight.OutlineTransparency = 0
                highlight.Adornee = player.Character
                highlight.Parent = player.Character
            end
        end
    end
end)

-- Click TP
createButton("Click TP Toggle", 5).MouseButton1Click:Connect(function()
    clickTP = not clickTP
end)

UIS.InputBegan:Connect(function(input, gpe)
    if gpe then return end
    if clickTP and input.UserInputType == Enum.UserInputType.MouseButton1 then
        local mouse = LocalPlayer:GetMouse()
        if mouse and mouse.Hit then
            local pos = mouse.Hit.Position
            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                LocalPlayer.Character:MoveTo(pos + Vector3.new(0,3,0))
            end
        end
    end
end)

-- Fly / Unfly
createButton("Fly / Unfly", 6).MouseButton1Click:Connect(function()
    flying = not flying
    local rootPart = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if flying and rootPart then
        bodyGyro = Instance.new("BodyGyro")
        bodyGyro.P = 9e4
        bodyGyro.MaxTorque = Vector3.new(9e9,9e9,9e9)
        bodyGyro.CFrame = rootPart.CFrame
        bodyGyro.Parent = rootPart

        bodyVel = Instance.new("BodyVelocity")
        bodyVel.Velocity = Vector3.zero
        bodyVel.MaxForce = Vector3.new(9e9,9e9,9e9)
        bodyVel.Parent = rootPart

        flyConn = RunService.RenderStepped:Connect(function()
            if not flying or not LocalPlayer.Character or not rootPart then return end
            local camCF = Camera.CFrame
            local moveDir = Vector3.zero
            if UIS:IsKeyDown(Enum.KeyCode.W) then moveDir += camCF.LookVector end
            if UIS:IsKeyDown(Enum.KeyCode.S) then moveDir -= camCF.LookVector end
            if UIS:IsKeyDown(Enum.KeyCode.A) then moveDir -= camCF.RightVector end
            if UIS:IsKeyDown(Enum.KeyCode.D) then moveDir += camCF.RightVector end
            if UIS:IsKeyDown(Enum.KeyCode.E) then moveDir += camCF.UpVector end
            if UIS:IsKeyDown(Enum.KeyCode.Q) then moveDir -= camCF.UpVector end
            if moveDir.Magnitude > 0 then bodyVel.Velocity = moveDir.Unit * flySpeed else bodyVel.Velocity = Vector3.zero end
            bodyGyro.CFrame = camCF
        end)
    else
        if flyConn then flyConn:Disconnect() end
        if bodyGyro then bodyGyro:Destroy() end
        if bodyVel then bodyVel:Destroy() end
        flyConn = nil bodyGyro = nil bodyVel = nil
    end
end)

-- =====================
-- Aqui você poderia adicionar:
-- Aimbot, Silent Aim, No Recoil inteligente, SkinChanger
-- usando o mesmo padrão de criação de botão moderno
-- =====================

print("[+] GUI moderna carregada com todas funcionalidades base!")
